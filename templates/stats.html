{% extends "base.html" %}

{% block import %}
    <script src="{{ url_for('static', filename='script/chart.min.js') }}"></script>
{% endblock %}

{% block header %}
    <h1>{% block title %}Stats{% endblock %}</h1>
{% endblock %}


{% block content %}
    <div class="container">
        <p class="text-center"><strong>Les extensions suivantes ont été ignorées:
            {% for item in ignored %}
            {{ item }}
            {% endfor %}
        </strong></p>

        <br>
        <div style="margin-left: auto; margin-right: auto; width: 600px">
            <canvas class="centered" id="histograme" width="600" height="400"></canvas>
        </div>
        <p class="text-center">Historique des changements</p>

        <br>
        <br>

        <div style="margin-left: auto; margin-right: auto; width: 600px">
            <canvas class="centered" id="doughnut" width="600" height="400"></canvas>
        </div>
        <p class="text-center">Part des changements par utilisateur</p>

        <br>
        <br>

        <p class="text-center"><strong>Responsabilitées par fichier</strong></p>
        <table class="table table-striped">
            <thead>
            <tr>
                <th scope="col">Fichier</th>
                {% for name in respNames %}
                <th scope="col">{{ name }}</th>
                {% endfor %}
            </tr>
            </thead>
            <tbody>
            {% for file in respFiles %}
            <tr>
                <th scope="row">{{ file }}</th>
                {% for value in respValues[loop.index -1] %}
                <td>{{ value }}</td>
                {% endfor %}
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>




    <script>
        /* inspired by https://www.patricksoftwareblog.com/creating-charts-with-chart-js-in-a-flask-application/ */
        //////////////////////////////////HISTOGRAME//////////////////////////////////
        // Global parameters:
        // do not resize the chart canvas when its container does
        Chart.defaults.global.responsive = false;

        // define the chart data
        var histogrameData = {
            labels: [{% for item in histLabels %}
                "{{item}}",
            {% endfor %}],
            datasets: [{% for user in histLegend %}
                {
                    label: '{{ user }}',
                    fill: true,
                    lineTension: 0.1,
                    backgroundColor: random_rgba(0.2),
                    borderColor: random_rgba(1),
                    borderCapStyle: 'butt',
                    borderDash: [],
                    borderDashOffset: 0.0,
                    borderJoinStyle: 'miter',
                    pointBorderColor: "rgba(75,192,192,1)",
                    pointBackgroundColor: "#fff",
                    pointBorderWidth: 1,
                    pointHoverRadius: 5,
                    pointHoverBackgroundColor: "rgba(75,192,192,1)",
                    pointHoverBorderColor: "rgba(220,220,220,1)",
                    pointHoverBorderWidth: 2,
                    pointRadius: 1,
                    pointHitRadius: 10,
                    data: [{% for item in histValues[loop.index -1] %}
                        {{item}},
                    {% endfor %}],
                    spanGaps: false
                },
            {% endfor %}]

        };

        // get chart canvas
        var ctx = document.getElementById("histograme").getContext("2d");

        // create the chart using the chart canvas
        var myhistograme = new Chart(ctx, {
            type: 'line',
            data: histogrameData,
        });

        /////////////////////////////////doughnut//////////////////////////////////
        var doughnutData = {
            labels: [{% for item in doLabels %}
                "{{item}}",
            {% endfor %}],
            datasets: [{
                data: [{% for item in doValues %}
                    {{item}},
                {% endfor %}],
                backgroundColor:
                    [{% for item in doValues %}
                        getRandomColor(),
                    {% endfor %}],
            }]
        };

        // get chart canvas
        ctx = document.getElementById("doughnut").getContext("2d");

        // create the chart using the chart canvas
        var mydoughnut = new Chart(ctx, {
            type: 'doughnut',
            data: doughnutData,
        });

        function getRandomColor() {
            // helper function inpired from https://stackoverflow.com/questions/25594478/different-color-for-each-bar-in-a-bar-chart-chartjs
            var letters = '0123456789ABCDEF'.split('');
            var color = '#';
            for (var i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        function random_rgba(t) {
            var o = Math.round, r = Math.random, s = 255;
            return 'rgba(' + o(r() * s) + ',' + o(r() * s) + ',' + o(r() * s) + ',' + t + ')';
        }

    </script>
{% endblock %}